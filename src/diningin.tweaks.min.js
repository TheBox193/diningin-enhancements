/**
 * @license
 * @name diningin.tweaks
 * @description A quick set of tweaks to dingingin.com Eat it up!
 * @version 1.7.1
 * @author Jonathan Stassen <jstassen.com>
 * @see https://github.com/TheBox193/diningin-enhancements
 */
function getCookie(e){for(var t=e+"=",n=document.cookie.split(";"),o=0;o<n.length;o++){for(var r=n[o];" "==r.charAt(0);)r=r.substring(1);if(0==r.indexOf(t))return r.substring(t.length,r.length)}return""}function menuHighlight(){var e=getHighlightThresholdValue();$(".menu-item").each(function(){var t=$(this).closest("tr"),n=getPriceByEl(t),o=Number(n*(1+TAX)).toFixed(2);o<=(Number(e)||11)?t.css("background-color","lightblue"):t.css("background-color","white")})}function getHighlightThresholdValue(){return options.doHighlightUnderValue-getCartTotal()}function checkCartTotal(){var e=getCartTotal();e!==lastCartTotal&&(lastCartTotal=e,menuHighlight())}function fixCheckout(){var e=$(".ibtnContinueBtnBev")[0];e&&"/checkout"!==e&&(e.href="/checkout")}function getLoved(){var e=[];return $("#MostedLoved .menu-item-data").each(function(){e.push(parseInt(this.textContent,10))}),e}function setLoved(e){getMenuItemElById(e).find(".ItemName").prepend('<span style="position: absolute; left: -4px;">❤</span>')}function convertPriceStringToNumber(e){return Number(e.replace(/[^0-9\.]+/g,""))}function getMenuItems(){return $(".tbl-MenuList > tbody > tr")}function getPriceByEl(e){return convertPriceStringToNumber(e.find(".ItemCost").text())}function getMenuItemIdByTr(e){return $(e).find("#DIVDescription > div > div > span").attr("id")}function getCartTotal(){return convertPriceStringToNumber($(".CartSubtotalLabel").text())}function getPriceById(e){return getPriceByEl(getMenuItemElById(e))}function getMenuItemElById(e){return $("#"+e).closest("tr")}function showLoved(){var e=getLoved();$.each(e,function(e,t){setLoved(t)})}function removeExtraneousElements(){var e=["#spnAddressInfo","#MPSContent > #tabnav","#mps_time_header_container",".mps_calendar_container > .mps_time_header_container","#ctl00_pageContentPlaceholder_cart_pnlTimeCart1","#menu_delivery_address","#ctl00_pageContentPlaceholder_CRestaurantTopBar_imgIsPremier","#DIVAlertNote","#spnCategoryDDL","#CartMid p:contains('item names')","#RestMenu td:contains('no prices')","#MostedLoved","#payment_info_title_container",".tip_container","#pnlStepTipsCoupons > #order_total_container","#pnlStepTipsCoupons .clear","#menu_your_order_delivery_time","#pnlBillingcode #lblBillingCode",".phone_number_email_container_item2 .email-receipts-message",".checkout_left_container_mid_payment_method #menu_delivery_time",".checkout_left_container_mid_payment_method #menu_delivery_loc",".checkout_left_container_mid_payment_method .delivery_instructions_for_driver_container:last",".checkout_left_container_mid_payment_method #select_payment_method_container:contains('following options')","#divPaymentContainer span:contains('is this')","#CartContainer #ctl01_pnlOrderPaymentMsg","#ctl01_pnlOrderPaymentMsg > .Default_message_box",".tip_coupon_gift_certificates_title","#order_total_below_container",".menu_your_order_container_top","#complete_process_my_order_container > #change_my_order_container",".checkout_left_container_top",".checkout_left_container_bottom","#footer_container","#InnerFooter_Container"];e.map(removeElement),$(".checkout_left_container_mid_payment_method, .checkout_left_container_mid").css({border:"none"})}function removeExtraneousMenuSections(){var e=[".MenuList:contains('12 Cans of Diet Coke')",".MenuList:contains('Large Catering Tongs')",".MenuList:contains('Single Use Canned Heat')"];e.map(removeElement)}function gfRestaurants(){var e=[1100807,1329,1100769,1101877,1100679,1100320,1100193,1100251,1002,1100279,1194,1100511,1443,1101878,1100183,1100167],t=$(".mps_grid_table .actionItem");t.each(function(t,n){$item=$(n);var o=$item.children(".rdata").text();e.forEach(function(e){o.search(" "+e)>0&&$item.append('<br><span style="color: #7FA64F;">(gf)<span>')})})}function averageDeliveryTimes(){var e=$(".mps_grid_table .actionItem");$.get(api+"averages/").then(function(t){e.each(function(e,n){$item=$(n);var o=$item.children(".rdata").text(),r=JSON.parse(o.replace(/(['"])?([a-zA-Z0-9_]+)(['"])?:/g,'"$2": ')),i=t[r.rl];if(i){var a=$("<div>Average Time:</div>").css("margin-top","8px").css("border-top","1px solid lightgray").css("padding-top","8px").css("font-size",12);$item.append(a);var s=i.split(":").slice(0,2).join(":"),c=$("<div>"+s+"<div>").css("padding-top","5px").css("font-size",15);$item.append(c)}})})}function getVotes(){onRestrauntPage&&$.get(api+"rest/"+restaurantID).then(function(e){e=e.reduce(function(e,t){var n=e.find(function(e){return e.itemID==t.item});return n||(e.push({itemID:t.item,votesup:0,votesdown:0,myVote:null,comments:[]}),n=e[e.length-1]),"up"===t.vote?n.votesup++:"down"===t.vote&&n.votesdown++,t.cmnt&&n.push({comment:t.cmnt,user:t.user}),t.user===user&&(n.myVote=t.vote),e},[]),e.forEach(function(e){var t=getMenuItemElById(e.itemID);t.find(".votes .up .count").text(e.votesup),t.find(".votes .down .count").text(e.votesdown),e.myVote&&t.find(".votes ."+e.myVote).css("color","green")})})}function removeElement(e){var t=$(e);t&&t.remove()}function setup(){options.doRemoveBackground&&(document.body.style.background="white"),options.doHighlightUnder&&(menuHighlight(),window.setInterval(checkCartTotal,1500)),options.doShowHearts&&showLoved(),options.doSkipDrinks&&window.setInterval(fixCheckout,1e3),options.doRemoveExtraneousElements&&removeExtraneousElements(),options.doRemoveExtraneousMenuSections&&removeExtraneousMenuSections(),options.doGfRestaurants&&gfRestaurants(),options.doAverageDeliveryTimes&&averageDeliveryTimes()}var TAX=.115,options,lastCartTotal,api="https://jstassen-01.jstassen.com/",route=window.location.pathname.split("/"),onRestrauntPage=route.indexOf("restaurant-menu")>-1,onRestrauntGrid=route.indexOf("prix-fixe")>-1&&2===route.length;if(onRestrauntPage)var restaurantID=route[6];var user=getCookie("EmailAddress");getMenuItems().prepend('<td class="votes" style="padding: 0 6px"><div class="up" style="cursor: pointer;"><span class="count"></span>⬆</div><div class="down" style="cursor: pointer;"><span class="count"></span>⬇</div></td>'),getVotes(),jQuery(".votes").click(function(e){var t=e.target.className,n=e.currentTarget.parentElement,o=getMenuItemIdByTr(n),r="rgb(0, 128, 0)"===$(n).find(".votes ."+t).css("color");if("up"===t||"down"===t){r&&(t="none");var i={user:user,rest:restaurantID,item:o,vote:t};$.post(api+"item/new",i),location.reload()}}),chrome.storage.sync.get({doHighlightUnder:!0,doHighlightUnderValue:11,doShowHearts:!0,doSkipDrinks:!0,doRemoveExtraneousElements:!1,doRemoveExtraneousMenuSections:!1,doRemoveBackground:!0,doGfRestaurants:!0,doAverageDeliveryTimes:!0},function(e){options=e,$(function(){setup()})});